<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;media-src 'self';style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://blog.wedrop.it name=base><title>Drop a Blog • A reply for Tim's StackOverflow question</title><link title="Drop a Blog - Atom Feed" href=https://blog.wedrop.it/atom.xml rel=alternate type=application/atom+xml><link href="https://blog.wedrop.it/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://blog.wedrop.it/main.css?h=fa464346b37e382872db" rel=stylesheet><meta content="light dark" name=color-scheme><meta content="An old Maemo friend reached out on Twitter and asked for help regarding some
issue he was running into using mysqli and PHP. Below is my response that I didn't have time to
post before the question was locked." name=description><meta content="An old Maemo friend reached out on Twitter and asked for help regarding some
issue he was running into using mysqli and PHP. Below is my response that I didn't have time to
post before the question was locked." property=og:description><meta content="A reply for Tim's StackOverflow question" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://blog.wedrop.it/blog/reply-tim-stackoverflow-question/ property=og:url><meta content="Drop a Blog" property=og:site_name><noscript><link href=https://blog.wedrop.it/no_js.css rel=stylesheet></noscript><script src=https://blog.wedrop.it/js/initializeTheme.min.js></script><script defer src=https://blog.wedrop.it/js/themeSwitcher.min.js></script><meta content=@teotwaki@mastodon.online name=fediverse:creator><script src="https://blog.wedrop.it/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://blog.wedrop.it>Drop a Blog</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://blog.wedrop.it/blog/>blog </a><li><a class="nav-links no-hover-padding" href=https://blog.wedrop.it/archive/>archive </a><li><a class="nav-links no-hover-padding" href=https://blog.wedrop.it/tags/>tags </a><li class=menu-icons-container><ul class=menu-icons-group><li class="js menu-icon"><div aria-label="Click or press $SHORTCUT to open search" class="search-icon interactive-icon" title="Click or press $SHORTCUT to open search" id=search-button role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><li class="theme-switcher-wrapper js"><div aria-label="Toggle dark mode" title="Toggle dark/light mode" aria-pressed=false class=theme-switcher role=button tabindex=0></div><div aria-label="Reset mode to default" class="theme-resetter arrow" title="Reset mode to default" aria-hidden=true role=button tabindex=0></div></ul></ul></div></nav></header><div class=content><main><article><h1 class=article-title>A reply for Tim’s StackOverflow question</h1><ul class=meta><li>25th Aug 2015<li title="460 words"><span aria-hidden=true class=separator>•</span>3 min read<li class=tag><span aria-hidden=true class=separator>•</span>Tags: <li class=tag><a href=https://blog.wedrop.it/tags/tech/>tech</a>, <li class=tag><a href=https://blog.wedrop.it/tags/sql/>sql</a></ul><section class=body><p>An old Maemo friend <a href=https://twitter.com/timsamoff/status/635230118160429056>reached out on Twitter</a> and asked for help regarding some issue he was running into using mysqli and PHP. Below is my response that I didn’t have time to post before <a href=http://stackoverflow.com/questions/32161519/mysqli-limit-won-t-work-for-me>the question</a> was locked.<p>Hi Tim,<p>Looks like you’ve had a few issues here :). As a general rule, I like to go back to pure-MySQL, and remove as much application logic as possible. In this case, as you’ve already discovered, it’s possible to do it all in MySQL.<p>But first, let’s do part of what you forgot to do (and which is probably why you got downvoted a bit): let’s create a test MySQL table so we can run some queries on it:<pre class="language-mysql z-code" data-lang=mysql><code class=language-mysql data-lang=mysql><span class="z-text z-plain">mysql> create table uploads (
</span><span class="z-text z-plain">    ->   af_uid int unsigned,
</span><span class="z-text z-plain">    ->   af_fid int unsigned,
</span><span class="z-text z-plain">    ->   af_dfilename varchar(100),
</span><span class="z-text z-plain">    ->   af_upload_date datetime
</span><span class="z-text z-plain">    -> );
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">mysql> insert into uploads values
</span><span class="z-text z-plain">    -> (101, 10, 'cat.jpg', '2015-08-16 14:42:46'),
</span><span class="z-text z-plain">    -> (101, 10, 'dog.jpg', '2015-08-16 14:43:01'),
</span><span class="z-text z-plain">    -> (101, 11, 'doc.pdf', '2015-08-16 14:44:23'),
</span><span class="z-text z-plain">    -> (101, 10, 'foo.jpg', '2015-08-16 14:45:00'),
</span><span class="z-text z-plain">    -> (101, 10, 'bar.jpg', '2015-08-16 14:45:36'),
</span><span class="z-text z-plain">    -> (101, 10, 'php.jpg', '2015-08-16 14:46:10'),
</span><span class="z-text z-plain">    -> (101, 10, 'mysql.jpg', '2015-08-16 14:46:52'),
</span><span class="z-text z-plain">    -> (102, 10, 'fubar.jpg', '2015-08-16 14:51:03');
</span></code></pre><p>From your question, there’s 4 parts to the query you’re trying to write:<ul><li>you only want <code>uid = 101</code>;<li>you only want <code>fid = 10</code>;<li>you want the 5 last items uploaded;<li>you only want the 5 first results.</ul><pre class="language-mysql z-code" data-lang=mysql><code class=language-mysql data-lang=mysql><span class="z-text z-plain">mysql> select *
</span><span class="z-text z-plain">    -> from uploads
</span><span class="z-text z-plain">    -> where af_uid = 101
</span><span class="z-text z-plain">    -> and af_fid = 10
</span><span class="z-text z-plain">    -> order by af_upload_date desc
</span><span class="z-text z-plain">    -> limit 5;
</span><span class="z-text z-plain">+--------+--------+--------------+---------------------+
</span><span class="z-text z-plain">| af_uid | af_fid | af_dfilename | af_upload_date      |
</span><span class="z-text z-plain">+--------+--------+--------------+---------------------+
</span><span class="z-text z-plain">|    101 |     10 | mysql.jpg    | 2015-08-16 14:46:52 |
</span><span class="z-text z-plain">|    101 |     10 | php.jpg      | 2015-08-16 14:46:10 |
</span><span class="z-text z-plain">|    101 |     10 | bar.jpg      | 2015-08-16 14:45:36 |
</span><span class="z-text z-plain">|    101 |     10 | foo.jpg      | 2015-08-16 14:45:00 |
</span><span class="z-text z-plain">|    101 |     10 | dog.jpg      | 2015-08-16 14:43:01 |
</span><span class="z-text z-plain">+--------+--------+--------------+---------------------+
</span><span class="z-text z-plain">5 rows in set (0.01 sec)
</span></code></pre><p>I’m not seeing <code>limit</code> misbehaving here, as long as the rest of the query does what it’s supposed to do. A couple notes to keep in mind for the future, though:<p>Please don’t put integer values in quotes. In SQL (and most other languages), there’s no reason to do so. You’re just asking the system to do more casting and whatnot. Secondly, try to do most work in MySQL, especially when it comes to filtering. Always try to reduce your dataset as much as possible in the first step. There are certain situations where it can be useful to do some filtering on the client side, but those are micro-optimisations that really only come in very later.<p>Anyway, now, let’s dig in to the rest of your question and more specifically, let’s try to figure out what was going wrong. If we run your original query directly in MySQL, we’ll notice that we get interesting results:<pre class="language-mysql z-code" data-lang=mysql><code class=language-mysql data-lang=mysql><span class="z-text z-plain">mysql> select *
</span><span class="z-text z-plain">    -> from uploads
</span><span class="z-text z-plain">    -> where af_uid = 101
</span><span class="z-text z-plain">    -> order by af_upload_date desc
</span><span class="z-text z-plain">    -> limit 5;
</span><span class="z-text z-plain">+--------+--------+--------------+---------------------+
</span><span class="z-text z-plain">| af_uid | af_fid | af_dfilename | af_upload_date      |
</span><span class="z-text z-plain">+--------+--------+--------------+---------------------+
</span><span class="z-text z-plain">|    101 |     10 | mysql.jpg    | 2015-08-16 14:46:52 |
</span><span class="z-text z-plain">|    101 |     10 | php.jpg      | 2015-08-16 14:46:10 |
</span><span class="z-text z-plain">|    101 |     10 | bar.jpg      | 2015-08-16 14:45:36 |
</span><span class="z-text z-plain">|    101 |     10 | foo.jpg      | 2015-08-16 14:45:00 |
</span><span class="z-text z-plain">|    101 |     11 | doc.pdf      | 2015-08-16 14:44:23 |
</span><span class="z-text z-plain">+--------+--------+--------------+---------------------+
</span><span class="z-text z-plain">5 rows in set (0.00 sec)
</span></code></pre><p>Notice that because of the order in which things appear in the table (due to the <code>order by</code> clause), the last item actually has <code>af_fid = 11</code>.<p>Now, if on the client side, we apply extra filtering as you’re doing with <code>if ($row['af_fid']) == 10)</code>, it would only make sense that we end up with only 4 results.<p>I’m not sure why you saw 3 results, but I’m going to warrant a guess and say that it was due to some differences in the code or data, compared to what you posted on SO. Conclusion: if you’d done all your filtering in SQL from the get go, you most probably would’ve never hit this roadblock to start with.<p>Feel free to ping me if you have other questions.</section></article></main><div id=button-container><a title="Go to the top of the page" class=no-hover-padding href=# id=top-button> <svg viewbox="0 0 20 20" fill=currentColor><path d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z"/></svg> </a></div></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://blog.wedrop.it/atom.xml> <img alt=feed loading=lazy src=https://blog.wedrop.it/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://github.com/teotwaki> <img alt=github loading=lazy src=https://blog.wedrop.it/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel=" me" href=https://mastodon.online/@teotwaki> <img alt=mastodon loading=lazy src=https://blog.wedrop.it/social_icons/mastodon.svg title=mastodon> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> <p><p>Drop a Blog © 2025 Sebastian Lauwers • Unless otherwise noted, the content in this website is available under the <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> license.</p> Powered by <a href=https://www.getzola.org>Zola</a> & <a href=https://github.com/welpo/tabi>tabi</a> • <a href=https://github.com/teotwaki/blog.wedrop.it> Site source </a></small></div></section><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><h1 class=visually-hidden id=modalTitle>Search</h1><div id=modal-content><div id=searchBar><div aria-hidden=true class=search-icon><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z"/></svg></div><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search… role=combobox spellcheck=false><div class="close-icon interactive-icon" title="Clear search" id=clear-search role=button tabindex=0><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></div></div><div id=results-container><div id=results-info><span id=zero_results> No results</span><span id=one_results> $NUMBER result</span><span id=many_results> $NUMBER results</span><span id=two_results> $NUMBER results</span><span id=few_results> $NUMBER results</span></div><div id=results role=listbox></div></div></div></div></footer>